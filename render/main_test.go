package main

import (
	"encoding/base64"
	"fmt"
	"io/ioutil"
	"net/http"
	"net/http/httptest"
	"net/url"
	"testing"
)

func TestRender(t *testing.T) {
	ts := httptest.NewServer(http.HandlerFunc(serve))
	defer ts.Close()
	response, err := http.PostForm(ts.URL, url.Values{"stl": []string{testPayload}})
	read, err := ioutil.ReadAll(response.Body)
	response.Body.Close()
	if err != nil {
		t.Error(fmt.Sprintln("IO error:", err))
	}
	fileCorrectB64, err := ioutil.ReadFile("testfile.test")
	fileCorrect, _ := base64.StdEncoding.DecodeString(string(fileCorrectB64))
	if string(fileCorrect) != string(read) {
		t.Error("Test failed!")
	}
}

var testPayload = "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"
