<!doctype html>
<html>
<head>
	<meta charset="utf-8">
	<title></title>
	<script src="https://cdn.jsdelivr.net/npm/canvg/dist/browser/canvg.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script type="text/javascript">

        function getMesh() {
            $.ajax({
                type: "GET",
                url: "http://garden.local/function/mesh",
                success: function(data) {
                    var dataObj = JSON.parse(data);
                    if (dataObj.TwoD != "") {
                        console.log("There's content on 2D!")
                        // canvg(document.getElementById('canvas'), "<svg width='300' height='300'></svg>")
                        // canvg(document.getElementById('canvas'), window.atob(dataObj.TwoD), {ignoreDimensions: true});
                        // $("#forminput").attr("value", data);
                        // viewBox="0 0 300 300" preserveAspectRatio="xMinYMin meet"
                        myObj = {
                            "Width": "300", 
                            "Height": "300", 
                            "SVGb64": dataObj.TwoD
                        };
                        postSVGtoPNG(JSON.stringify(myObj))
                    }

                    if (dataObj.ThreeD != "") {
                        console.log("There's content on 3D!")
                        postRender(dataObj.ThreeD)
                    }
                    setTimeout(function() {
                        getMesh();
                    }, 3000);
                }
            })
        };

        function postSVGtoPNG(data) {
            $("#forminputsvg").attr("value", data);
            $("#formidsvg").submit();
        }

        function postRender(data) {
            $("#forminput").attr("value", data);
            $("#formid").submit();
        };

        
        getMesh()
// Cache-Control: no-store
// newImage.src = "http://localhost/image.jpg?" + new Date().getTime();

	</script>

	<style type="text/css">
	</style>
</head>
<body>
    <!-- <canvas id="canvas" width="300px" height="300px"></canvas> -->
    
    <iframe name="pic" id="pic" src="about:blank" height="300" width="300" style="border: 1px solid black;"></iframe>
    <form action="http://garden.local/function/render" method="post" target="pic" id="formid">
        <input id="forminput" type="hidden" name="stl" value="bar" />
    </form>

    <iframe name="svgpic" id="svgpic" src="about:blank" height="300" width="300" style="border: 1px solid black;"></iframe>
    <form action="http://garden.local/svgtopng" method="post" target="svgpic" id="formidsvg">
        <input id="forminputsvg" type="hidden" name="svg" value="bar" />
    </form>


</body>
</html>